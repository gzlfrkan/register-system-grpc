syntax = "proto3";

package family;

option java_multiple_files = true;
option java_package = "family";
option java_outer_classname = "FamilyProto";

message NodeInfo {
  string host = 1;
  int32 port = 2;
}

message FamilyView {
  repeated NodeInfo members = 1;
}

message Empty {}

message ChatMessage {
  string text = 1;
  string fromHost = 2;
  int32 fromPort = 3;
  int64 timestamp = 4;
}

// Dağıtık GET için - diğer düğümlerden değer sorgulama
message KeyRequest {
  int32 key = 1;
}

message ValueResponse {
  int32 key = 1;
  string value = 2;
  bool found = 3;
}

// Düğüm depolama bilgisi - boyut bazlı yük dengeleme için
message StorageInfo {
  string host = 1;
  int32 port = 2;
  int32 fileCount = 3;
  int64 totalBytes = 4;
}

service FamilyService {
  rpc Join (NodeInfo) returns (FamilyView);
  rpc GetFamily (Empty) returns (FamilyView);

  rpc ReceiveChat (ChatMessage) returns (Empty);
  
  // Dağıtık GET - diğer düğümlerden değer al
  rpc GetValue (KeyRequest) returns (ValueResponse);
  
  // Depolama bilgisi sorgulama - yük dengeleme için
  rpc GetStorageInfo (Empty) returns (StorageInfo);
}
